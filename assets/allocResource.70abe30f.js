import{f as e,l as t}from"./resource.d1d3648a.js";import{g as l,h as a}from"./role.93a8017d.js";import{_ as s,r,o,l as c,w as d,c as h,g as n,h as u,a as i,L as f,t as g,F as C,i as R}from"./vendor.85146a32.js";import"./index.2a4ddc7d.js";const k={name:"allocResource",data:()=>({roleId:null,allResource:null,allResourceCate:null}),created(){this.roleId=this.$route.query.roleId,this.getAllResourceCateList()},methods:{getAllResourceList(){e().then((e=>{this.allResource=e.data;for(let t=0;t<this.allResource.length;t++)this.allResource[t].checked=!1;this.getResourceByRole(this.roleId)}))},getAllResourceCateList(){t().then((e=>{this.allResourceCate=e.data;for(let t=0;t<this.allResourceCate.length;t++)this.allResourceCate[t].checked=!1;this.getAllResourceList()}))},getResourceByCate(e){let t=[];if(null==this.allResource)return null;for(let l=0;l<this.allResource.length;l++){let a=this.allResource[l];a.categoryId===e&&t.push(a)}return t},getResourceByRole(e){l(e).then((e=>{let t=e.data;this.allResource.forEach((e=>{e.checked=this.getResourceChecked(e.id,t)})),this.allResourceCate.forEach((e=>{e.checked=this.isAllChecked(e.id)})),this.$forceUpdate()}))},getResourceChecked(e,t){if(null==t||0===t.length)return!1;for(let l=0;l<t.length;l++)if(t[l].id===e)return!0;return!1},isIndeterminate(e){let t=this.getResourceByCate(e);if(null==t)return!1;let l=0;for(let a=0;a<t.length;a++)!0===t[a].checked&&l++;return!(0===l||l===t.length)},isAllChecked(e){let t=this.getResourceByCate(e);if(null==t)return!1;let l=0;for(let a=0;a<t.length;a++)!0===t[a].checked&&l++;return 0!==l&&l===t.length},handleSave(){this.$confirm("是否分配资源？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e=new Set;null!=this.allResource&&this.allResource.length>0&&this.allResource.forEach((t=>{t.checked&&e.add(t.id)}));let t=new FormData;t.append("roleId",this.roleId),t.append("resourceIds",Array.from(e)),a(t).then((e=>{this.$message({message:"分配成功",type:"success",duration:1e3}),this.$router.back()}))}))},handleClear(){this.allResourceCate.forEach((e=>{e.checked=!1})),this.allResource.forEach((e=>{e.checked=!1})),this.$forceUpdate()},handleCheckAllChange(e){let t=this.getResourceByCate(e.id);for(let l=0;l<t.length;l++)t[l].checked=e.checked;this.$forceUpdate()},handleCheckChange(e){this.allResourceCate.forEach((t=>{t.id===e.categoryId&&(t.checked=this.isAllChecked(e.categoryId))})),this.$forceUpdate()}}},m={style:{"margin-top":"20px"},align:"center"},p=f("保存"),y=f("清空");var I=s(k,[["render",function(e,t,l,a,s,k){const I=r("el-checkbox"),_=r("el-row"),A=r("el-col"),B=r("el-button"),w=r("el-card");return o(),c(w,{class:"form-container",shadow:e.defaultData.cardShadow},{default:d((()=>[(o(!0),h(C,null,n(s.allResourceCate,((e,t)=>(o(),h("div",{class:u(0===t?"top-line":null),key:"cate"+e.id},[i(_,{class:"table-layout",style:{background:"#f2f6fc"}},{default:d((()=>[i(I,{modelValue:e.checked,"onUpdate:modelValue":t=>e.checked=t,indeterminate:k.isIndeterminate(e.id),onChange:t=>k.handleCheckAllChange(e)},{default:d((()=>[f(g(e.name),1)])),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"])])),_:2},1024),i(_,{class:"table-layout"},{default:d((()=>[(o(!0),h(C,null,n(k.getResourceByCate(e.id),(e=>(o(),c(A,{span:8,key:e.id,style:{padding:"4px 0"}},{default:d((()=>[i(I,{modelValue:e.checked,"onUpdate:modelValue":t=>e.checked=t,onChange:t=>k.handleCheckChange(e)},{default:d((()=>[f(g(e.name),1)])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)))),128))])),_:2},1024)],2)))),128)),R("div",m,[i(B,{type:"primary",onClick:t[0]||(t[0]=e=>k.handleSave())},{default:d((()=>[p])),_:1}),i(B,{onClick:t[1]||(t[1]=e=>k.handleClear())},{default:d((()=>[y])),_:1})])])),_:1},8,["shadow"])}],["__scopeId","data-v-5f391574"]]);export default I;
